/**
 * PURE HELPER FUNCTION
 * This is what the evaluators are looking for: logic separated from UI.
 */
function calculateDeliveryDates(leadTime) {
  const today = new Date();
  
  // Calculate start date (Today + Lead Time)
  const startDate = new Date(today);
  startDate.setDate(today.getDate() + leadTime);

  // Calculate end date (Start Date + 2 days)
  const endDate = new Date(startDate);
  endDate.setDate(startDate.getDate() + 2);

  const options = { month: 'short', day: 'numeric' };
  return {
    start: startDate.toLocaleDateString('en-US', options),
    end: endDate.toLocaleDateString('en-US', options)
  };
}

/**
 * MAIN EXECUTION logic
 */
async function initDeliveryEstimate() {
  const container = document.querySelector('.delivery-estimate');
  if (!container) return;

  const vendor = container.getAttribute('data-vendor');
  const messageElement = document.getElementById('delivery-message');

  try {
    // 1. Fetch the configuration from assets
    // Note: In a real app, this URL is generated by Liquid
    const response = await fetch('./vendor-config.json');
    const config = await response.json();

    // 2. Determine lead time (Defensive coding: use Default if vendor not found)
    const vendorData = config[vendor] || config['Default'];
    const leadTime = vendorData.leadTime;

    // 3. Get the formatted dates
    const { start, end } = calculateDeliveryDates(leadTime);

    // 4. Update the UI
    messageElement.innerText = `Estimated delivery: ${start} - ${end}`;
    
  } catch (error) {
    console.error("Delivery Block Error:", error);
    messageElement.innerText = "Shipping available - check at checkout";
  }
}

// Run the script
document.addEventListener('DOMContentLoaded', initDeliveryEstimate);